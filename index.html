<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Major Trauma Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        html { scroll-behavior: smooth; }
        
        .toggle-radio:checked + div {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        .tag-checkbox:checked + span {
            background-color: #e2e8f0;
            border-color: #94a3b8;
            color: #1e293b;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 antialiased">

    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-slate-200">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-slate-900 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    Trauma Tool
                </h1>
            </div>
            <nav class="hidden md:flex space-x-1 bg-slate-100 p-1 rounded-lg text-xs font-semibold text-slate-600">
                <a href="#sec-primary" class="px-3 py-1 hover:bg-white rounded transition">Primary</a>
                <a href="#sec-mhp" class="px-3 py-1 hover:bg-white rounded transition">MHP</a>
                <a href="#sec-secondary" class="px-3 py-1 hover:bg-white rounded transition">Secondary</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-7 xl:col-span-8 flex flex-col space-y-6">

                <section class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-lg font-bold text-slate-900 flex items-center">
                            <span class="w-1.5 h-6 bg-slate-800 mr-2 rounded-full"></span>Arrival & Specialties
                        </h2>
                        <button id="btn-arrival-now" class="px-3 py-1 bg-slate-800 text-white text-xs font-bold rounded hover:bg-slate-700">Set Arrival Time: NOW</button>
                    </div>
                    <div class="mb-3 flex gap-2 overflow-x-auto pb-2">
                        <button type="button" class="specialty-btn px-3 py-1.5 bg-blue-50 text-blue-700 border border-blue-200 rounded text-xs font-bold hover:bg-blue-100" data-spec="T&O">T&O Arrived</button>
                        <button type="button" class="specialty-btn px-3 py-1.5 bg-blue-50 text-blue-700 border border-blue-200 rounded text-xs font-bold hover:bg-blue-100" data-spec="Gen Surg">Gen Surg Arrived</button>
                        <button type="button" class="specialty-btn px-3 py-1.5 bg-blue-50 text-blue-700 border border-blue-200 rounded text-xs font-bold hover:bg-blue-100" data-spec="ICU/Anaesthetics">ICU/Anaes Arrived</button>
                    </div>
                    <textarea id="specialtyAttendances" rows="2" class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md text-sm transition" placeholder="Specialty arrival times..."></textarea>
                </section>

                <section id="sec-atmist" class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-900 mb-4 flex items-center">
                        <span class="w-1.5 h-6 bg-blue-600 mr-2 rounded-full"></span>ATMIST Handover
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Age</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="age" class="flex-1 px-3 py-2 border border-slate-300 rounded-md text-sm">
                                <label class="flex items-center space-x-2 text-sm text-slate-600 bg-slate-50 px-3 py-2 border rounded-md cursor-pointer"><input type="checkbox" id="ageEstimated" class="rounded text-blue-600"><span>Est.</span></label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Time of Incident</label>
                            <input type="time" id="timeOfIncident" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm">
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div><input type="text" id="mechanism" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Mechanism"></div>
                        <div><input type="text" id="injuries" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Injuries Suspected"></div>
                        <div><input type="text" id="signs" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Signs (Vitals)"></div>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-900 mb-4 flex items-center"><span class="w-1.5 h-6 bg-slate-400 mr-2 rounded-full"></span>Pre-Hospital</h2>
                    <textarea id="preHospitalOther" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm mb-4" placeholder="Notes..."></textarea>
                    
                    <div class="pt-4 border-t border-slate-100">
                        <h3 class="text-sm font-bold text-slate-700 uppercase mb-3">AMPLE History</h3>
                        <div class="grid grid-cols-1 gap-2">
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">A</span><input type="text" id="history_a" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">M</span><input type="text" id="history_m" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">P</span><input type="text" id="history_p" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">L</span><input type="text" id="history_l" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">E</span><input type="text" id="history_e" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm"></div>
                        </div>
                    </div>
                </section>

                <div id="sec-primary" class="pt-2"><h2 class="text-2xl font-bold text-slate-800 border-b pb-2">Primary Survey</h2></div>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-blue-500 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-blue-800 mb-4">A - Airway</h3>
                    
                    <div class="mb-4">
                        <label class="flex items-center space-x-2 mb-3">
                            <input type="checkbox" id="preHospitalRSI" class="w-5 h-5 text-red-600 rounded border-gray-300 focus:ring-red-500">
                            <span class="font-bold text-red-700">Pre-Hospital RSI Performed</span>
                        </label>

                        <div class="flex rounded-md shadow-sm bg-slate-100 p-1 mb-4">
                             <label class="cursor-pointer flex-1 text-center"><input type="radio" name="airwayStatus" value="Patent" checked class="sr-only toggle-radio peer"><div class="px-2 py-1.5 rounded text-sm font-medium transition">Patent</div></label>
                             <label class="cursor-pointer flex-1 text-center"><input type="radio" name="airwayStatus" value="Compromised" class="sr-only toggle-radio peer"><div class="px-2 py-1.5 rounded text-sm font-medium transition">Compromised</div></label>
                             <label class="cursor-pointer flex-1 text-center"><input type="radio" name="airwayStatus" value="At Risk" class="sr-only toggle-radio peer"><div class="px-2 py-1.5 rounded text-sm font-medium transition">At Risk</div></label>
                             <label class="cursor-pointer flex-1 text-center"><input type="radio" name="airwayStatus" value="Intubated" class="sr-only toggle-radio peer"><div class="px-2 py-1.5 rounded text-sm font-medium transition">Intubated</div></label>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded border border-blue-100 mb-3">
                        <span class="text-xs font-bold text-blue-800 uppercase block mb-2">C-Spine Protection</span>
                        <div class="flex gap-4">
                             <label class="flex items-center space-x-2"><input type="checkbox" id="cspine_collar" class="w-4 h-4 text-blue-600 rounded"><span>Collar</span></label>
                             <label class="flex items-center space-x-2"><input type="checkbox" id="cspine_blocks" class="w-4 h-4 text-blue-600 rounded"><span>Blocks</span></label>
                        </div>
                    </div>

                    <textarea id="airway_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Airway Notes (Tube size, grade, length)..."></textarea>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-sky-400 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-sky-700 mb-4">B - Breathing</h3>
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">RR</label><input type="number" id="breathing_rr" class="w-full text-lg font-mono font-bold px-2 py-1 border border-slate-300 rounded text-center"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Sats (%)</label><input type="number" id="breathing_sats" class="w-full text-lg font-mono font-bold px-2 py-1 border border-slate-300 rounded text-center"></div>
                            <div class="col-span-2">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">O2 Delivery</label>
                                <div class="flex rounded-md shadow-sm w-full bg-white">
                                    <label class="cursor-pointer flex-1"><input type="radio" name="breathing_o2" value="Air" checked class="sr-only toggle-radio peer"><div class="py-1.5 text-sm font-medium border border-slate-300 rounded-l text-center">Air</div></label>
                                    <label class="cursor-pointer flex-1"><input type="radio" name="breathing_o2" value="O2" class="sr-only toggle-radio peer"><div class="py-1.5 text-sm font-medium border-y border-r border-slate-300 rounded-r text-center">Oxygen</div></label>
                                </div>
                            </div>
                        </div>
                        <div id="fio2_container" class="hidden mt-3"><input type="text" id="breathing_fio2" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="Flow Rate / FiO2"></div>
                    </div>
                    <div class="mb-4"><label class="block text-sm font-bold text-slate-700 mb-2">Findings</label><div id="breathing_findings" class="grid grid-cols-1 sm:grid-cols-2 gap-2"></div></div>
                    <textarea id="breathing_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Notes..."></textarea>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-red-500 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-red-700 mb-4">C - Circulation</h3>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">HR</label><input type="number" id="circ_hr" class="w-full text-lg font-mono font-bold px-2 py-1 border border-slate-300 rounded text-center"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">BP</label><input type="text" id="circ_bp" class="w-full text-lg font-mono font-bold px-2 py-1 border border-slate-300 rounded text-center"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">CRT</label><input type="number" id="circ_capRefill" class="w-full text-lg font-mono font-bold px-2 py-1 border border-slate-300 rounded text-center"></div>
                        </div>
                    </div>

                    <div class="mb-4 space-y-3">
                         <div>
                            <span class="text-xs font-bold text-slate-500 uppercase">Access & Lines</span>
                            <div class="flex flex-wrap gap-2 mt-1">
                                <button type="button" class="access-btn px-2 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" data-text="IV Access (L) ACF">IV (L)</button>
                                <button type="button" class="access-btn px-2 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" data-text="IV Access (R) ACF">IV (R)</button>
                                <button type="button" class="access-btn px-2 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" data-text="IO Access (Humeral)">IO (Humeral)</button>
                                <button type="button" class="access-btn px-2 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" data-text="IO Access (Tibial)">IO (Tibial)</button>
                                <button type="button" class="access-btn px-2 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" data-text="Central Line">Central Line</button>
                                <button type="button" class="access-btn px-2 py-1 bg-white border border-slate-300 rounded text-xs hover:bg-slate-50" data-text="Arterial Line">Art. Line</button>
                            </div>
                        </div>
                        <div>
                            <span class="text-xs font-bold text-slate-500 uppercase">Haemorrhage Control</span>
                            <div class="flex flex-wrap gap-2 mt-1">
                                <button type="button" class="access-btn px-2 py-1 bg-red-50 border border-red-200 text-red-700 rounded text-xs hover:bg-red-100" data-text="Pelvic Binder applied">Pelvic Binder</button>
                                <button type="button" class="access-btn px-2 py-1 bg-red-50 border border-red-200 text-red-700 rounded text-xs hover:bg-red-100" data-text="KTD Splint applied">KTD</button>
                                <button type="button" class="access-btn px-2 py-1 bg-red-50 border border-red-200 text-red-700 rounded text-xs hover:bg-red-100" data-text="Tourniquet applied">Tourniquet</button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-red-50 p-3 rounded border border-red-100 mb-3">
                         <span class="block text-xs font-bold text-red-800 uppercase mb-2">TXA Given</span>
                         <div class="flex gap-4">
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="txaGiven" value="None" checked class="text-red-600 focus:ring-red-500"><span>None</span></label>
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="txaGiven" value="1g" class="text-red-600 focus:ring-red-500"><span>1g</span></label>
                            <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="txaGiven" value="2g" class="text-red-600 focus:ring-red-500"><span>2g</span></label>
                         </div>
                    </div>
                    
                    <textarea id="circ_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Circulation Notes..."></textarea>
                </section>

                <section id="sec-mhp" class="bg-red-100 p-5 rounded-lg shadow-sm border-2 border-red-500">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-xl font-bold text-red-900">Major Haemorrhage Protocol (MHP)</h2>
                         <label class="cursor-pointer flex items-center bg-white px-3 py-1 border border-red-300 rounded shadow-sm">
                            <input type="checkbox" id="mhp_activated" class="w-5 h-5 text-red-600 rounded">
                            <span class="ml-2 font-bold text-red-800">ACTIVATED</span>
                        </label>
                    </div>

                    <div class="bg-white border-l-4 border-red-600 p-3 mb-4 shadow-sm">
                        <p class="font-black text-red-600 text-center">⚠️ PROMPT: GIVE TRANEXAMIC ACID & CALCIUM ⚠️</p>
                    </div>

                    <div id="mhpDetails" class="hidden space-y-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div><label class="block text-xs font-bold text-red-800 uppercase mb-1">PRBC</label><input type="number" id="mhp_prbc" class="w-full px-2 py-1 border border-red-300 rounded text-center font-mono" placeholder="0"></div>
                            <div><label class="block text-xs font-bold text-red-800 uppercase mb-1">FFP</label><input type="number" id="mhp_ffp" class="w-full px-2 py-1 border border-red-300 rounded text-center font-mono" placeholder="0"></div>
                            <div><label class="block text-xs font-bold text-red-800 uppercase mb-1">Platelets</label><input type="number" id="mhp_plt" class="w-full px-2 py-1 border border-red-300 rounded text-center font-mono" placeholder="0"></div>
                            <div><label class="block text-xs font-bold text-red-800 uppercase mb-1">Cryo</label><input type="number" id="mhp_cryo" class="w-full px-2 py-1 border border-red-300 rounded text-center font-mono" placeholder="0"></div>
                        </div>
                        <div><label class="block text-xs font-bold text-red-800 uppercase mb-1">Notes</label><textarea id="mhp_notes" rows="2" class="w-full px-3 py-2 border border-red-300 rounded text-sm"></textarea></div>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-yellow-400 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-yellow-700 mb-4">D - Disability</h3>
                    
                    <div class="mb-4">
                        <label class="flex items-center space-x-2 p-2 bg-yellow-50 border border-yellow-200 rounded w-fit mb-3">
                            <input type="checkbox" id="headInjury" class="w-5 h-5 text-yellow-600 rounded border-gray-300 focus:ring-yellow-500">
                            <span class="font-bold text-yellow-800">Head Injury Suspected</span>
                        </label>
                        
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">AVPU</label>
                        <div class="inline-flex rounded-md shadow-sm w-full" role="group">
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Alert" checked class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border border-slate-300 rounded-l hover:bg-slate-50 text-center">A</div></label>
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Voice" class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border-y border-r border-slate-300 hover:bg-slate-50 text-center">V</div></label>
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Pain" class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border-y border-r border-slate-300 hover:bg-slate-50 text-center">P</div></label>
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Unresponsive" class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border-y border-r border-slate-300 rounded-r hover:bg-slate-50 text-center">U</div></label>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-3 mb-4">
                         <div><label class="block text-xs font-medium text-slate-500 mb-1">GCS Eyes</label><select id="disability_gcsE" class="w-full text-sm border-slate-300 rounded"></select></div>
                         <div><label class="block text-xs font-medium text-slate-500 mb-1">GCS Verbal</label><select id="disability_gcsV" class="w-full text-sm border-slate-300 rounded"></select></div>
                         <div><label class="block text-xs font-medium text-slate-500 mb-1">GCS Motor</label><select id="disability_gcsM" class="w-full text-sm border-slate-300 rounded"></select></div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4 bg-yellow-50 p-3 rounded border border-yellow-100">
                        <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">L Pupil</label><input type="text" id="disability_pupil_left" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="e.g. 3mm"></div>
                        <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">R Pupil</label><input type="text" id="disability_pupil_right" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="e.g. 3mm"></div>
                        <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Glucose</label><input type="number" id="disability_glucose" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="mmol/L"></div>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-green-700 mb-3">E - Exposure</h3>
                    <div class="w-1/3 mb-3"><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Temp</label><input type="number" id="exposure_temp" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm"></div>
                    <textarea id="exposure_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Notes..."></textarea>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-800 mb-4">Investigations & Plan</h2>
                     <div class="bg-slate-50 p-3 rounded border border-slate-200 mb-4">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Initial VBG/ABG</h4>
                        <div class="grid grid-cols-4 sm:grid-cols-7 gap-2">
                            <div><label class="block text-[10px] uppercase text-slate-500">pH</label><input type="number" id="vbgInitial_ph" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">pCO2</label><input type="number" id="vbgInitial_pco2" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">pO2</label><input type="number" id="vbgInitial_po2" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">HCO3</label><input type="number" id="vbgInitial_hco3" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">BE</label><input type="number" id="vbgInitial_be" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">Lac</label><input type="number" id="vbgInitial_lactate" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">Ca++</label><input type="number" id="vbgInitial_ionisedCa" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div><label class="block text-sm font-medium mb-1">Imaging Decisions</label><textarea id="imagingDecisions" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></textarea></div>
                    </div>
                </section>

                <section id="sec-secondary" class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold text-slate-800 mb-4 pb-2 border-b">Secondary Survey</h2>
                    
                    <div id="secondary_container" class="space-y-4"></div>
                </section>
                
                 <section class="bg-slate-800 p-5 rounded-lg shadow-md text-white">
                    <h2 class="text-lg font-bold mb-3">Problem List / Impression</h2>
                    <textarea id="problemList" rows="5" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm text-white placeholder-slate-400"></textarea>
                </section>
            </div>

            <div class="lg:col-span-5 xl:col-span-4 relative">
                <div class="sticky top-24 space-y-6">
                    <section class="bg-white p-4 rounded-lg shadow-lg border border-slate-200">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Initial Note</h2>
                            <button id="copyInitial" class="px-3 py-1 text-xs font-bold bg-blue-600 text-white rounded hover:bg-blue-700 transition">Copy</button>
                        </div>
                        <textarea readonly id="initialNoteOutput" class="w-full h-80 p-3 bg-slate-50 border border-slate-200 rounded text-xs font-mono text-slate-600 whitespace-pre-wrap focus:outline-none resize-none"></textarea>
                    </section>
                    
                    <section class="bg-white p-4 rounded-lg shadow-lg border border-slate-200">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Secondary Survey Note</h2>
                            <button id="copySecondary" class="px-3 py-1 text-xs font-bold bg-blue-600 text-white rounded hover:bg-blue-700 transition">Copy</button>
                        </div>
                        <textarea readonly id="secondaryNoteOutput" class="w-full h-80 p-3 bg-slate-50 border border-slate-200 rounded text-xs font-mono text-slate-600 whitespace-pre-wrap focus:outline-none resize-none"></textarea>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DATA STORE ---
            const patientData = {
                arrival: { time: '', specialties: [] },
                atmist: { age: '', ageEst: false, time: '', mech: '', inj: '', signs: '' },
                prehosp: { notes: '', history: {a:'', m:'', p:'', l:'', e:''} },
                airway: { status: 'Patent', rsi: false, collar: false, blocks: false, notes: '' },
                breathing: { rr: '', sats: '', o2: 'Air', fio2: '', findings: [], notes: '' },
                circulation: { hr: '', bp: '', crt: '', access: [], txa: 'None', binder: false, ktd: false, tourniquet: false, notes: '' },
                mhp: { activated: false, prbc: '', ffp: '', plt: '', cryo: '', notes: '' },
                disability: { avpu: 'Alert', headInjury: false, gcsE: 4, gcsV: 5, gcsM: 6, pupilL: '', pupilR: '', glucose: '' },
                exposure: { temp: '', notes: '' },
                investigations: { vbg: {ph:'', pco2:'', po2:'', hco3:'', be:'', lac:'', ca:''}, imaging: '' },
                secondary: {}, // Populated dynamically
                problemList: ''
            };

            const SS_AREAS = [
                { id: 'head', label: 'Head', tags: ['Normocephalic', 'Laceration', 'Haematoma', 'Bony Tenderness'] },
                { id: 'face', label: 'Face', tags: ['Symmetrical', 'Laceration', 'Bony Tenderness', 'Le Fort instability'] },
                { id: 'eyes', label: 'Eyes', tags: ['PERLA', 'EOMI', 'Racoon Eyes', 'Subconj. Haem'] },
                { id: 'neck', label: 'Neck', tags: ['Trachea Central', 'Non-tender', 'Deformity', 'Steps'] },
                { id: 'chest', label: 'Chest', tags: ['Expansion Eq.', 'Non-tender', 'Crepitus', 'Bruising'] },
                { id: 'abdo', label: 'Abdomen', tags: ['Soft', 'Non-tender', 'Distended', 'Seatbelt Sign', 'Guarding'] },
                { id: 'pelvis', label: 'Pelvis', tags: ['Stable', 'Non-tender', 'Unstable', 'Bruising'] },
                { id: 'back', label: 'Back', tags: ['No steps', 'Non-tender', 'Step deformity', 'Bruising'] },
                { id: 'limbs', label: 'Limbs', tags: ['Move 4 limbs', 'Neuro Intact', 'Deformity', 'Fracture Suspected'] }
            ];

            // --- UI HELPERS ---
            const getEl = (id) => document.getElementById(id);
            const getTime = () => new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

            // --- RENDER SECONDARY SURVEY UI ---
            const secContainer = getEl('secondary_container');
            SS_AREAS.forEach(area => {
                const div = document.createElement('div');
                div.className = "mb-4 pb-4 border-b border-slate-100 last:border-0";
                
                let tagsHtml = `<div class="flex flex-wrap gap-2 mb-2">`;
                area.tags.forEach(tag => {
                    tagsHtml += `<label class="cursor-pointer"><input type="checkbox" class="tag-checkbox hidden" data-area="${area.id}" value="${tag}"><span class="px-2 py-1 text-xs border border-slate-300 rounded hover:bg-slate-50 transition select-none">${tag}</span></label>`;
                });
                tagsHtml += `</div>`;

                div.innerHTML = `
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">${area.label}</label>
                    ${tagsHtml}
                    <textarea id="ss_${area.id}" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm" placeholder="Details..."></textarea>
                `;
                secContainer.appendChild(div);
                
                // Initialize data storage for this area
                patientData.secondary[area.id] = { tags: [], text: '' };
            });

            // --- UPDATE LOGIC ---
            function updateNotes() {
                // INITIAL NOTE
                const p = patientData;
                let t = `**Major Trauma Assessment**\n`;
                if(p.arrival.time) t += `Arrival Time: ${p.arrival.time}\n`;
                if(p.arrival.specialties.length) t += `Specialties Present: ${p.arrival.specialties.join(', ')}\n`;
                
                t += `\n**ATMIST**\nAge: ${p.atmist.age}${p.atmist.ageEst?'(Est)':''} | Time: ${p.atmist.time}\nMech: ${p.atmist.mech}\nInj: ${p.atmist.inj}\nSigns: ${p.atmist.signs}\n`;
                
                if(p.prehosp.notes) t+= `Pre-Hospital: ${p.prehosp.notes}\n`;
                t += `AMPLE: A:${p.prehosp.history.a} M:${p.prehosp.history.m} P:${p.prehosp.history.p} L:${p.prehosp.history.l} E:${p.prehosp.history.e}\n`;

                t += `\n**PRIMARY SURVEY**\n`;
                t += `A: ${p.airway.status}. ${p.airway.rsi ? 'Pre-Hosp RSI. ' : ''}C-Spine: ${p.airway.collar?'Collar ':''}${p.airway.blocks?'Blocks':''}. ${p.airway.notes}\n`;
                
                let o2 = p.breathing.o2 === 'Air' ? 'Air' : `O2 ${p.breathing.fio2}`;
                t += `B: RR ${p.breathing.rr} Sats ${p.breathing.sats}% (${o2}). ${p.breathing.findings.map(f=>`${f.f}(${f.s})`).join(', ')}. ${p.breathing.notes}\n`;
                
                t += `C: HR ${p.circulation.hr} BP ${p.circulation.bp} CRT ${p.circulation.crt}. TXA: ${p.circulation.txa}.\n`;
                if(p.circulation.access.length) t += `   Access/Lines: ${p.circulation.access.join(', ')}\n`;
                if(p.circulation.binder || p.circulation.ktd || p.circulation.tourniquet) {
                    let interventions = [];
                    if(p.circulation.binder) interventions.push("Binder");
                    if(p.circulation.ktd) interventions.push("KTD");
                    if(p.circulation.tourniquet) interventions.push("Tourniquet");
                    t += `   Interventions: ${interventions.join(', ')}\n`;
                }
                t += `   ${p.circulation.notes}\n`;

                if(p.mhp.activated) {
                    t += `**MHP ACTIVATED**\nGiven: PRBC ${p.mhp.prbc || 0}, FFP ${p.mhp.ffp || 0}, Plt ${p.mhp.plt || 0}, Cryo ${p.mhp.cryo || 0}. ${p.mhp.notes}\n`;
                }

                let gcsTot = parseInt(p.disability.gcsE) + parseInt(p.disability.gcsV) + parseInt(p.disability.gcsM);
                t += `D: AVPU ${p.disability.avpu}. GCS ${gcsTot} (E${p.disability.gcsE}V${p.disability.gcsV}M${p.disability.gcsM}). Pupils: L ${p.disability.pupilL} R ${p.disability.pupilR}. BMs ${p.disability.glucose}. ${p.disability.headInjury ? '**Head Injury Suspected**' : ''}\n`;
                
                t += `E: Temp ${p.exposure.temp}. ${p.exposure.notes}\n`;
                
                const v = p.investigations.vbg;
                t += `\nVBG: pH ${v.ph} pCO2 ${v.pco2} pO2 ${v.po2} HCO3 ${v.hco3} BE ${v.be} Lac ${v.lac} Ca ${v.ca}\n`;
                t += `Plan: ${p.investigations.imaging}\n`;
                
                getEl('initialNoteOutput').value = t;

                // SECONDARY NOTE
                let s = `**Secondary Survey**\n\n`;
                SS_AREAS.forEach(area => {
                    const data = p.secondary[area.id];
                    const hasTags = data.tags.length > 0;
                    const hasText = data.text.length > 0;
                    if (hasTags || hasText) {
                        s += `- ${area.label}: ${data.tags.join(', ')}${hasTags && hasText ? '. ' : ''}${data.text}\n`;
                    }
                });
                s += `\n**Problem List**\n${p.problemList}`;
                getEl('secondaryNoteOutput').value = s;
            }

            // --- EVENT LISTENERS ---
            
            // Buttons
            getEl('btn-arrival-now').addEventListener('click', () => {
                patientData.arrival.time = getTime();
                updateNotes();
            });

            document.querySelectorAll('.specialty-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const txt = `${e.target.dataset.spec} @ ${getTime()}`;
                    patientData.arrival.specialties.push(txt);
                    // Also append to text area for manual edit
                    const ta = getEl('specialtyAttendances');
                    ta.value = ta.value ? ta.value + ', ' + txt : txt;
                    updateNotes();
                });
            });

            document.querySelectorAll('.access-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const val = e.target.dataset.text;
                    e.target.classList.toggle('bg-blue-100'); // Visual toggle
                    e.target.classList.toggle('border-blue-500');
                    
                    if(val.includes('Binder')) patientData.circulation.binder = !patientData.circulation.binder;
                    else if(val.includes('KTD')) patientData.circulation.ktd = !patientData.circulation.ktd;
                    else if(val.includes('Tourniquet')) patientData.circulation.tourniquet = !patientData.circulation.tourniquet;
                    else {
                        // Access lines list
                        if(patientData.circulation.access.includes(val)) {
                            patientData.circulation.access = patientData.circulation.access.filter(i => i !== val);
                        } else {
                            patientData.circulation.access.push(val);
                        }
                    }
                    updateNotes();
                });
            });

            // Input Bindings
            const bind = (id, path, key) => {
                const el = getEl(id);
                if(!el) return;
                el.addEventListener('input', (e) => {
                    path[key] = e.target.value;
                    updateNotes();
                });
            };

            const bindCheck = (id, path, key) => {
                const el = getEl(id);
                if(!el) return;
                el.addEventListener('change', (e) => {
                    path[key] = e.target.checked;
                    if(id === 'breathing_o2' || id === 'mhp_activated') {
                        // Toggle UI visibility
                        if(id === 'breathing_o2') getEl('fio2_container').classList.toggle('hidden', !e.target.checked);
                        if(id === 'mhp_activated') getEl('mhpDetails').classList.toggle('hidden', !e.target.checked);
                    }
                    updateNotes();
                });
            };

            // Bind Top & ATMIST
            bind('specialtyAttendances', patientData.arrival, 'specialties'); // Actually string, handled in update
            bind('age', patientData.atmist, 'age');
            bindCheck('ageEstimated', patientData.atmist, 'ageEst');
            bind('timeOfIncident', patientData.atmist, 'time');
            bind('mechanism', patientData.atmist, 'mech');
            bind('injuries', patientData.atmist, 'inj');
            bind('signs', patientData.atmist, 'signs');
            bind('preHospitalOther', patientData.prehosp, 'notes');
            ['a','m','p','l','e'].forEach(k => bind(`history_${k}`, patientData.prehosp.history, k));

            // Bind Airway
            bindCheck('preHospitalRSI', patientData.airway, 'rsi');
            bindCheck('cspine_collar', patientData.airway, 'collar');
            bindCheck('cspine_blocks', patientData.airway, 'blocks');
            bind('airway_notes', patientData.airway, 'notes');
            document.querySelectorAll('input[name="airwayStatus"]').forEach(r => r.addEventListener('change', e => { patientData.airway.status = e.target.value; updateNotes(); }));

            // Bind Breathing
            bind('breathing_rr', patientData.breathing, 'rr');
            bind('breathing_sats', patientData.breathing, 'sats');
            bind('breathing_fio2', patientData.breathing, 'fio2');
            bind('breathing_notes', patientData.breathing, 'notes');
            document.querySelectorAll('input[name="breathing_o2"]').forEach(r => r.addEventListener('change', e => { 
                patientData.breathing.o2 = e.target.value; 
                getEl('fio2_container').classList.toggle('hidden', e.target.value === 'Air');
                updateNotes(); 
            }));
            
            // Breathing Findings Checkboxes generated in HTML (re-using prev logic simplified)
            const bFindingsDiv = getEl('breathing_findings');
            ['Crepitus', 'Surg Emphysema', 'Bruising', 'Deformity'].forEach(f => {
                bFindingsDiv.innerHTML += `
                    <div class="flex items-center justify-between bg-slate-50 px-2 py-1 rounded text-xs border border-slate-100">
                        <span>${f}</span>
                        <div class="space-x-1">
                            <label class="cursor-pointer font-bold hover:text-blue-600"><input type="checkbox" data-f="${f}" data-s="L" class="b-find hidden">L</label>
                            <label class="cursor-pointer font-bold hover:text-blue-600"><input type="checkbox" data-f="${f}" data-s="R" class="b-find hidden">R</label>
                        </div>
                    </div>`;
            });
            bFindingsDiv.addEventListener('change', e => {
                if(e.target.classList.contains('b-find')) {
                    const { f, s } = e.target.dataset;
                    if(e.target.checked) patientData.breathing.findings.push({f,s});
                    else patientData.breathing.findings = patientData.breathing.findings.filter(x => !(x.f===f && x.s===s));
                    if(e.target.checked) e.target.parentElement.classList.add('text-blue-600');
                    else e.target.parentElement.classList.remove('text-blue-600');
                    updateNotes();
                }
            });

            // Bind Circ
            bind('circ_hr', patientData.circulation, 'hr');
            bind('circ_bp', patientData.circulation, 'bp');
            bind('circ_capRefill', patientData.circulation, 'crt');
            bind('circ_notes', patientData.circulation, 'notes');
            document.querySelectorAll('input[name="txaGiven"]').forEach(r => r.addEventListener('change', e => { patientData.circulation.txa = e.target.value; updateNotes(); }));

            // Bind MHP
            bindCheck('mhp_activated', patientData.mhp, 'activated');
            bind('mhp_prbc', patientData.mhp, 'prbc');
            bind('mhp_ffp', patientData.mhp, 'ffp');
            bind('mhp_plt', patientData.mhp, 'plt');
            bind('mhp_cryo', patientData.mhp, 'cryo');
            bind('mhp_notes', patientData.mhp, 'notes');

            // Bind Disability
            bindCheck('headInjury', patientData.disability, 'headInjury');
            document.querySelectorAll('input[name="disability_avpu"]').forEach(r => r.addEventListener('change', e => { patientData.disability.avpu = e.target.value; updateNotes(); }));
            const popSel = (id, opts, def) => { const s=getEl(id); opts.forEach(o=>s.add(new Option(o,o))); s.value=def; s.addEventListener('change',e=>{patientData.disability[id.split('_')[1]]=e.target.value; updateNotes();})};
            popSel('disability_gcsE', [4,3,2,1], 4);
            popSel('disability_gcsV', [5,4,3,2,1], 5);
            popSel('disability_gcsM', [6,5,4,3,2,1], 6);
            bind('disability_pupil_left', patientData.disability, 'pupilL');
            bind('disability_pupil_right', patientData.disability, 'pupilR');
            bind('disability_glucose', patientData.disability, 'glucose');

            // Bind Exposure & Inv
            bind('exposure_temp', patientData.exposure, 'temp');
            bind('exposure_notes', patientData.exposure, 'notes');
            ['ph','pco2','po2','hco3','be','lactate','ionisedCa'].forEach(k => {
                const map = {lactate:'lac', ionisedCa:'ca'};
                bind(`vbgInitial_${k}`, patientData.investigations.vbg, map[k]||k);
            });
            bind('imagingDecisions', patientData.investigations, 'imaging');
            bind('problemList', patientData, 'problemList');

            // Bind Secondary Survey Tags & Text
            secContainer.addEventListener('change', (e) => {
                const areaId = e.target.dataset.area || e.target.id.replace('ss_', '');
                if (e.target.classList.contains('tag-checkbox')) {
                    const tag = e.target.value;
                    if (e.target.checked) patientData.secondary[areaId].tags.push(tag);
                    else patientData.secondary[areaId].tags = patientData.secondary[areaId].tags.filter(t => t !== tag);
                } else if (e.target.tagName === 'TEXTAREA') {
                    patientData.secondary[areaId].text = e.target.value;
                }
                updateNotes();
            });
            
             // Copy Logic
            ['Initial', 'Secondary'].forEach(type => {
                const btn = getEl(`copy${type}`);
                btn.addEventListener('click', () => {
                    navigator.clipboard.writeText(getEl(`${type.toLowerCase()}NoteOutput`).value);
                    const t = btn.textContent; btn.textContent = 'Copied!'; setTimeout(()=>btn.textContent=t, 1500);
                });
            });

            updateNotes();
        });
    </script>
</body>
</html>
