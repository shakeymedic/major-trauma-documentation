<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Major Trauma Assessment Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        textarea::-webkit-scrollbar { width: 8px; }
        textarea::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        textarea::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        html { scroll-behavior: smooth; }
        
        /* Utility for toggle buttons */
        .toggle-radio:checked + div {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 antialiased">

    <header class="bg-white shadow-sm sticky top-0 z-50 border-b border-slate-200">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <div>
                <h1 class="text-xl sm:text-2xl font-bold text-slate-900 flex items-center gap-2">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    Trauma Documentation
                </h1>
                <p class="text-xs text-slate-500 font-medium">ED Assessment & Handover Tool</p>
            </div>
            <nav class="hidden md:flex space-x-1 bg-slate-100 p-1 rounded-lg text-xs font-semibold text-slate-600">
                <a href="#sec-atmist" class="px-3 py-1 hover:bg-white hover:shadow-sm rounded transition">ATMIST</a>
                <a href="#sec-primary" class="px-3 py-1 hover:bg-white hover:shadow-sm rounded transition">Primary Survey</a>
                <a href="#sec-investigations" class="px-3 py-1 hover:bg-white hover:shadow-sm rounded transition">Plan</a>
                <a href="#sec-secondary" class="px-3 py-1 hover:bg-white hover:shadow-sm rounded transition">Secondary</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-7 xl:col-span-8 flex flex-col space-y-6">

                <section class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-900 mb-3 flex items-center">
                        <span class="w-1.5 h-6 bg-slate-800 mr-2 rounded-full"></span>Specialty Attendances
                    </h2>
                    <textarea id="specialtyAttendances" rows="2" class="w-full px-3 py-2 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm transition" placeholder="e.g., Orthopaedics @ 14:35, Gen Surg @ 14:40"></textarea>
                </section>

                <section id="sec-atmist" class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-900 mb-4 flex items-center">
                        <span class="w-1.5 h-6 bg-blue-600 mr-2 rounded-full"></span>ATMIST Handover
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="age" class="block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-1">Age</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="age" class="flex-1 px-3 py-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm">
                                <label class="flex items-center space-x-2 text-sm text-slate-600 bg-slate-50 px-3 py-2 border rounded-md cursor-pointer hover:bg-slate-100">
                                    <input type="checkbox" id="ageEstimated" class="rounded text-blue-600 focus:ring-blue-500">
                                    <span class="font-medium">Est.</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label for="timeOfIncident" class="block text-xs font-semibold text-slate-500 uppercase tracking-wide mb-1">Time of Incident</label>
                            <input type="time" id="timeOfIncident" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm">
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="mechanism" class="block text-sm font-medium text-slate-700 mb-1">Mechanism</label>
                            <textarea id="mechanism" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm" placeholder="e.g., High speed MVC, rollover"></textarea>
                        </div>
                        <div>
                            <label for="injuries" class="block text-sm font-medium text-slate-700 mb-1">Injuries Suspected</label>
                            <textarea id="injuries" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm" placeholder="e.g., Chest pain, open tibial fracture"></textarea>
                        </div>
                        <div>
                            <label for="signs" class="block text-sm font-medium text-slate-700 mb-1">Signs (Initial Vitals)</label>
                            <textarea id="signs" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm" placeholder="e.g., Tachycardic, hypotensive"></textarea>
                        </div>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-900 mb-4 flex items-center">
                        <span class="w-1.5 h-6 bg-slate-400 mr-2 rounded-full"></span>Pre-Hospital Info
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="incidentLocation" class="block text-xs font-semibold text-slate-500 uppercase mb-1">Location</label>
                            <input type="text" id="incidentLocation" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm">
                        </div>
                        <div>
                             <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Police Aware?</label>
                             <div class="flex rounded-md shadow-sm" role="group">
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="policeAware" value="Yes" class="sr-only toggle-radio peer">
                                    <div class="px-4 py-2 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-l-md hover:bg-slate-50 text-center transition">Yes</div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="policeAware" value="No" class="sr-only toggle-radio peer">
                                    <div class="px-4 py-2 text-sm font-medium text-slate-700 bg-white border-t border-b border-r border-slate-300 hover:bg-slate-50 text-center transition">No</div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="policeAware" value="Unknown" checked class="sr-only toggle-radio peer">
                                    <div class="px-4 py-2 text-sm font-medium text-slate-700 bg-white border-t border-b border-r border-slate-300 rounded-r-md hover:bg-slate-50 text-center transition">Unk</div>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div><label class="block text-sm font-medium text-slate-700 mb-1">Timings</label><input type="text" id="preHospitalTimings" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="On scene / Left scene"></div>
                             <div><label class="block text-sm font-medium text-slate-700 mb-1">Interventions</label><input type="text" id="preHospitalTreatment" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Fluids, TXA, Splinting"></div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Other Notes</label>
                            <textarea id="preHospitalOther" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm"></textarea>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-slate-100">
                        <h3 class="text-sm font-bold text-slate-700 uppercase tracking-wider mb-3">AMPLE History</h3>
                        <div class="grid grid-cols-1 gap-2">
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">A</span><input type="text" id="history_a" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm" placeholder="Allergies"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">M</span><input type="text" id="history_m" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm" placeholder="Medications"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">P</span><input type="text" id="history_p" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm" placeholder="Past Medical History"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">L</span><input type="text" id="history_l" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm" placeholder="Last Meal"></div>
                            <div class="flex items-center gap-2"><span class="w-8 font-bold text-slate-400">E</span><input type="text" id="history_e" class="flex-1 px-3 py-1.5 border border-slate-300 rounded text-sm" placeholder="Events"></div>
                        </div>
                    </div>
                </section>

                <section class="bg-red-50 p-5 rounded-lg shadow-sm border border-red-200">
                    <h2 class="text-lg font-bold text-red-800 mb-4 flex items-center">
                        <span class="w-8 h-8 rounded-full bg-red-600 text-white flex items-center justify-center text-sm font-bold mr-2">&lt;C&gt;</span> Catastrophic Haemorrhage
                    </h2>
                    <div class="flex items-center gap-4 mb-4">
                        <span class="text-sm font-medium text-red-900">Evidence of Catastrophic Haemorrhage?</span>
                        <div class="inline-flex rounded-md shadow-sm" role="group">
                             <label class="cursor-pointer">
                                <input type="radio" name="catHaem" value="No" checked class="sr-only toggle-radio peer">
                                <div class="px-4 py-1.5 text-sm font-medium bg-white border border-red-300 rounded-l-md text-slate-700 hover:bg-red-100 transition">No</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="catHaem" value="Yes" class="sr-only toggle-radio peer">
                                <div class="px-4 py-1.5 text-sm font-medium bg-white border-t border-b border-r border-red-300 rounded-r-md text-slate-700 hover:bg-red-100 transition">Yes</div>
                            </label>
                        </div>
                    </div>
                    
                    <div id="catHaemDetails" class="hidden space-y-3 pl-2 border-l-2 border-red-300">
                        <div><label class="block text-xs font-semibold text-red-700 uppercase mb-1">Source</label><input type="text" id="catHaem_details" class="w-full px-3 py-2 border border-red-300 rounded text-sm focus:ring-red-500"></div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div><label class="block text-xs font-semibold text-red-700 uppercase mb-1">Tourniquet</label><input type="text" id="catHaem_tourniquet" class="w-full px-3 py-2 border border-red-300 rounded text-sm focus:ring-red-500"></div>
                            <div><label class="block text-xs font-semibold text-red-700 uppercase mb-1">Intervention</label><input type="text" id="catHaem_intervention" class="w-full px-3 py-2 border border-red-300 rounded text-sm focus:ring-red-500"></div>
                        </div>
                    </div>
                </section>

                <div id="sec-primary" class="pt-2"><h2 class="text-2xl font-bold text-slate-800 border-b pb-2">Primary Survey</h2></div>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-blue-500 border-y border-r border-slate-200">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-xl font-bold text-blue-800">A - Airway</h3>
                        <div class="flex rounded-md shadow-sm bg-slate-100 p-1">
                             <label class="cursor-pointer">
                                <input type="radio" name="airwayStatus" value="Patent" checked class="sr-only toggle-radio peer">
                                <div class="px-3 py-1 rounded text-sm font-medium transition">Patent</div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="airwayStatus" value="Compromised" class="sr-only toggle-radio peer">
                                <div class="px-3 py-1 rounded text-sm font-medium transition">Compromised</div>
                            </label>
                             <label class="cursor-pointer">
                                <input type="radio" name="airwayStatus" value="At Risk" class="sr-only toggle-radio peer">
                                <div class="px-3 py-1 rounded text-sm font-medium transition">At Risk</div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                         <label class="flex items-center p-3 border border-blue-100 bg-blue-50 rounded-md cursor-pointer hover:bg-blue-100 transition">
                            <input type="checkbox" id="cSpineImmobilised" class="w-5 h-5 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                            <span class="ml-3 font-medium text-blue-900">C-Spine Immobilised (Collar/Blocks)</span>
                        </label>
                    </div>
                    <div>
                        <label for="airway_notes" class="block text-sm font-medium text-slate-700 mb-1">Notes & Interventions</label>
                        <textarea id="airway_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="e.g., Suction, OPA/NPA, iGel..."></textarea>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-sky-400 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-sky-700 mb-4">B - Breathing</h3>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-4">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">RR</label>
                                <input type="number" id="breathing_rr" class="w-full text-lg font-mono font-semibold px-3 py-2 border border-slate-300 rounded focus:ring-sky-500 focus:border-sky-500 text-center" placeholder="--">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Sats (%)</label>
                                <input type="number" id="breathing_sats" class="w-full text-lg font-mono font-semibold px-3 py-2 border border-slate-300 rounded focus:ring-sky-500 focus:border-sky-500 text-center" placeholder="--">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">O2 Delivery</label>
                                <div class="flex w-full">
                                    <div class="inline-flex rounded-md shadow-sm flex-1" role="group">
                                        <label class="cursor-pointer flex-1">
                                            <input type="radio" name="breathing_o2" value="On Air" checked class="sr-only toggle-radio peer">
                                            <div class="w-full px-2 py-2.5 text-sm font-medium bg-white border border-slate-300 rounded-l hover:bg-slate-50 text-center">Air</div>
                                        </label>
                                        <label class="cursor-pointer flex-1">
                                            <input type="radio" name="breathing_o2" value="On Oxygen" class="sr-only toggle-radio peer">
                                            <div class="w-full px-2 py-2.5 text-sm font-medium bg-white border-y border-r border-slate-300 rounded-r hover:bg-slate-50 text-center">Oxygen</div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="fio2_container" class="hidden mt-3 pt-3 border-t border-slate-200">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">FiO2 / Flow (L/min)</label>
                            <input type="text" id="breathing_fio2" class="w-full px-3 py-1 border border-slate-300 rounded text-sm" placeholder="e.g. 15L NRB">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div><label class="block text-sm font-medium text-slate-600">Percussion</label><input type="text" id="breathing_percussion" value="Resonant" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></div>
                        <div><label class="block text-sm font-medium text-slate-600">Auscultation</label><input type="text" id="breathing_auscultation" value="Equal air entry" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-slate-700 mb-2">Findings</label>
                        <div id="breathing_findings" class="grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                    </div>

                    <textarea id="breathing_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Notes & Interventions..."></textarea>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-red-500 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-red-700 mb-4">C - Circulation</h3>
                    
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 mb-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Heart Rate</label>
                                <input type="number" id="circ_hr" class="w-full text-lg font-mono font-semibold px-3 py-2 border border-slate-300 rounded focus:ring-red-500 focus:border-red-500 text-center" placeholder="--">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">BP</label>
                                <input type="text" id="circ_bp" class="w-full text-lg font-mono font-semibold px-3 py-2 border border-slate-300 rounded focus:ring-red-500 focus:border-red-500 text-center" placeholder="--/--">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">CRT (s)</label>
                                <input type="number" id="circ_capRefill" class="w-full text-lg font-mono font-semibold px-3 py-2 border border-slate-300 rounded focus:ring-red-500 focus:border-red-500 text-center" placeholder="--">
                            </div>
                        </div>
                        <div class="mt-3 flex gap-2">
                             <div class="inline-flex rounded-md shadow-sm w-full" role="group">
                                <label class="cursor-pointer flex-1">
                                    <input type="radio" name="circ_bp_type" value="Non-Invasive" checked class="sr-only toggle-radio peer">
                                    <div class="w-full px-2 py-1 text-xs font-bold bg-white border border-slate-300 rounded-l hover:bg-slate-50 text-center text-slate-500 uppercase">NIBP</div>
                                </label>
                                <label class="cursor-pointer flex-1">
                                    <input type="radio" name="circ_bp_type" value="Invasive" class="sr-only toggle-radio peer">
                                    <div class="w-full px-2 py-1 text-xs font-bold bg-white border-y border-r border-slate-300 rounded-r hover:bg-slate-50 text-center text-slate-500 uppercase">Art. Line</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                             <div><label class="block text-sm font-medium text-slate-600 mb-1">Pelvis Stability</label><input type="text" id="circ_pelvis" value="Stable" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></div>
                             <div><label class="block text-sm font-medium text-slate-600 mb-1">Blood on Floor / PR</label><input type="text" id="circ_floor" value="No PR" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></div>
                        </div>
                        
                        <div>
                             <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Palpable Pulse</label>
                             <div class="flex flex-wrap gap-2">
                                 <label class="cursor-pointer"><input type="radio" name="pulse_check" value="Radial" class="peer sr-only"><span class="px-3 py-1 border rounded-full text-sm peer-checked:bg-red-600 peer-checked:text-white peer-checked:border-red-600">Radial</span></label>
                                 <label class="cursor-pointer"><input type="radio" name="pulse_check" value="Brachial" class="peer sr-only"><span class="px-3 py-1 border rounded-full text-sm peer-checked:bg-red-600 peer-checked:text-white peer-checked:border-red-600">Brachial</span></label>
                                 <label class="cursor-pointer"><input type="radio" name="pulse_check" value="Femoral/Carotid" class="peer sr-only"><span class="px-3 py-1 border rounded-full text-sm peer-checked:bg-red-600 peer-checked:text-white peer-checked:border-red-600">Central</span></label>
                                 <label class="cursor-pointer"><input type="radio" name="pulse_check" value="None" checked class="peer sr-only"><span class="px-3 py-1 border rounded-full text-sm peer-checked:bg-slate-600 peer-checked:text-white peer-checked:border-slate-600">None</span></label>
                             </div>
                        </div>

                        <div class="bg-red-50 p-3 rounded border border-red-100 grid grid-cols-1 md:grid-cols-3 gap-4">
                             <div>
                                 <span class="block text-xs font-bold text-red-800 uppercase mb-1">TXA Given?</span>
                                 <div class="inline-flex rounded shadow-sm w-full">
                                    <label class="cursor-pointer flex-1"><input type="radio" name="txaGiven" value="Yes" class="sr-only toggle-radio peer"><div class="px-2 py-1 text-sm bg-white border border-red-200 rounded-l text-center">Yes</div></label>
                                    <label class="cursor-pointer flex-1"><input type="radio" name="txaGiven" value="No" checked class="sr-only toggle-radio peer"><div class="px-2 py-1 text-sm bg-white border-y border-r border-red-200 rounded-r text-center">No</div></label>
                                 </div>
                             </div>
                             <div>
                                 <span class="block text-xs font-bold text-red-800 uppercase mb-1">Transfusion?</span>
                                 <div class="inline-flex rounded shadow-sm w-full">
                                    <label class="cursor-pointer flex-1"><input type="radio" name="transfusionRequired" value="Yes" class="sr-only toggle-radio peer"><div class="px-2 py-1 text-sm bg-white border border-red-200 rounded-l text-center">Yes</div></label>
                                    <label class="cursor-pointer flex-1"><input type="radio" name="transfusionRequired" value="No" checked class="sr-only toggle-radio peer"><div class="px-2 py-1 text-sm bg-white border-y border-r border-red-200 rounded-r text-center">No</div></label>
                                 </div>
                             </div>
                             <div>
                                 <span class="block text-xs font-bold text-red-800 uppercase mb-1">Calcium?</span>
                                 <div class="inline-flex rounded shadow-sm w-full">
                                    <label class="cursor-pointer flex-1"><input type="radio" name="calciumGiven" value="Yes" class="sr-only toggle-radio peer"><div class="px-2 py-1 text-sm bg-white border border-red-200 rounded-l text-center">Yes</div></label>
                                    <label class="cursor-pointer flex-1"><input type="radio" name="calciumGiven" value="No" checked class="sr-only toggle-radio peer"><div class="px-2 py-1 text-sm bg-white border-y border-r border-red-200 rounded-r text-center">No</div></label>
                                 </div>
                             </div>
                        </div>
                        
                        <textarea id="circ_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Circulation Notes..."></textarea>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-yellow-400 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-yellow-700 mb-4">D - Disability</h3>
                    
                    <div class="mb-4">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">AVPU</label>
                        <div class="inline-flex rounded-md shadow-sm w-full" role="group">
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Alert" checked class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border border-slate-300 rounded-l hover:bg-slate-50 text-center">A</div></label>
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Voice" class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border-y border-r border-slate-300 hover:bg-slate-50 text-center">V</div></label>
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Pain" class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border-y border-r border-slate-300 hover:bg-slate-50 text-center">P</div></label>
                            <label class="cursor-pointer flex-1"><input type="radio" name="disability_avpu" value="Unresponsive" class="sr-only toggle-radio peer"><div class="px-2 py-2 text-sm font-bold bg-white border-y border-r border-slate-300 rounded-r hover:bg-slate-50 text-center">U</div></label>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                         <div><label class="block text-xs font-medium text-slate-500 mb-1">GCS Eyes</label><select id="disability_gcsE" class="w-full text-sm border-slate-300 rounded"></select></div>
                         <div><label class="block text-xs font-medium text-slate-500 mb-1">GCS Verbal</label><select id="disability_gcsV" class="w-full text-sm border-slate-300 rounded"></select></div>
                         <div><label class="block text-xs font-medium text-slate-500 mb-1">GCS Motor</label><select id="disability_gcsM" class="w-full text-sm border-slate-300 rounded"></select></div>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4 bg-yellow-50 p-3 rounded border border-yellow-100">
                        <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Left Pupil</label><input type="text" id="disability_pupil_left" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="e.g. 3mm"></div>
                        <div><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Right Pupil</label><input type="text" id="disability_pupil_right" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="e.g. 3mm"></div>
                        <div class="col-span-2 md:col-span-1"><label class="block text-xs font-bold text-slate-500 uppercase mb-1">Glucose</label><input type="number" id="disability_glucose" class="w-full px-2 py-1 border border-slate-300 rounded text-sm" placeholder="mmol/L"></div>
                    </div>

                    <textarea id="disability_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Disability Notes..."></textarea>
                    
                    <div class="mt-4 pt-4 border-t border-slate-200">
                        <label class="block text-sm font-bold text-slate-700 mb-2">C-Spine Assessment</label>
                        <div id="cspine_criteria" class="space-y-2 mb-3"></div>
                        <select id="cspine_decision" class="w-full px-3 py-2 border-slate-300 bg-slate-50 rounded-md text-sm font-medium">
                            <option>Clinically Cleared</option>
                            <option selected>Imaging Required</option>
                            <option>Unable to Assess</option>
                        </select>
                    </div>
                </section>

                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500 border-y border-r border-slate-200">
                    <h3 class="text-xl font-bold text-green-700 mb-4">E - Exposure</h3>
                    <div class="mb-3 w-1/3">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Temperature</label>
                        <input type="number" id="exposure_temp" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Â°C">
                    </div>
                    <textarea id="exposure_notes" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded-md text-sm" placeholder="Injuries, Warming measures..."></textarea>
                </section>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <section class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                        <h2 class="text-lg font-bold text-slate-800 mb-3">EFAST Scan</h2>
                        <div id="efast_views" class="space-y-2 mb-3 text-sm"></div>
                        <textarea id="efast_summary" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded text-sm" placeholder="Summary..."></textarea>
                    </section>
                    
                    <section class="bg-red-50 p-5 rounded-lg shadow-sm border border-red-200">
                        <h2 class="text-lg font-bold text-red-800 mb-3">Massive Haemorrhage</h2>
                        <div class="mb-3">
                             <div class="inline-flex rounded-md shadow-sm w-full">
                                <label class="cursor-pointer flex-1">
                                    <input type="radio" name="mhp" value="No" checked class="sr-only toggle-radio peer">
                                    <div class="px-4 py-2 text-sm font-medium bg-white border border-red-200 rounded-l hover:bg-red-50 text-slate-600 text-center">No</div>
                                </label>
                                <label class="cursor-pointer flex-1">
                                    <input type="radio" name="mhp" value="Yes" class="sr-only toggle-radio peer">
                                    <div class="px-4 py-2 text-sm font-bold bg-white border-y border-r border-red-200 rounded-r hover:bg-red-50 text-red-600 text-center">ACTIVATED</div>
                                </label>
                            </div>
                        </div>
                        <div id="mhpDetails" class="hidden space-y-2">
                            <input type="time" id="mhp_time" class="w-full px-2 py-1 border border-red-300 rounded text-sm">
                            <textarea id="mhp_packGiven" rows="1" class="w-full px-2 py-1 border border-red-300 rounded text-sm" placeholder="Packs..."></textarea>
                            <textarea id="mhp_notes" rows="1" class="w-full px-2 py-1 border border-red-300 rounded text-sm" placeholder="Notes..."></textarea>
                        </div>
                    </section>
                </div>

                <section id="sec-investigations" class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-lg font-bold text-slate-800 mb-4">Investigations & Plan</h2>
                    
                    <div class="bg-slate-50 p-3 rounded border border-slate-200 mb-4">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Initial VBG/ABG</h4>
                        <div class="grid grid-cols-4 sm:grid-cols-7 gap-2">
                            <div><label class="block text-[10px] uppercase text-slate-500">pH</label><input type="number" id="vbgInitial_ph" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">pCO2</label><input type="number" id="vbgInitial_pco2" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">pO2</label><input type="number" id="vbgInitial_po2" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">HCO3</label><input type="number" id="vbgInitial_hco3" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">BE</label><input type="number" id="vbgInitial_be" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">Lac</label><input type="number" id="vbgInitial_lactate" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">Ca++</label><input type="number" id="vbgInitial_ionisedCa" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                        </div>
                        <textarea id="vbgInitial_notes" rows="1" class="w-full mt-2 px-2 py-1 text-sm border-slate-300 rounded" placeholder="VBG Notes"></textarea>
                    </div>

                    <div class="space-y-4">
                        <div><label class="block text-sm font-medium mb-1">ECG</label><textarea id="ecg" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></textarea></div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Pregnancy</label>
                            <div class="flex flex-wrap gap-2">
                                <label class="cursor-pointer"><input type="radio" name="pregnancy" value="Not applicable" checked class="peer sr-only"><span class="px-3 py-1 bg-slate-100 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white">N/A</span></label>
                                <label class="cursor-pointer"><input type="radio" name="pregnancy" value="Positive" class="peer sr-only"><span class="px-3 py-1 bg-slate-100 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white">Pos</span></label>
                                <label class="cursor-pointer"><input type="radio" name="pregnancy" value="Negative" class="peer sr-only"><span class="px-3 py-1 bg-slate-100 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white">Neg</span></label>
                                <label class="cursor-pointer"><input type="radio" name="pregnancy" value="Pending" class="peer sr-only"><span class="px-3 py-1 bg-slate-100 rounded text-xs peer-checked:bg-blue-600 peer-checked:text-white">Pending</span></label>
                            </div>
                        </div>

                        <div><label class="block text-sm font-medium mb-1">Drugs (Analgesia/Antiemetics)</label><textarea id="drugsPrescribed" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></textarea></div>
                        <div><label class="block text-sm font-medium mb-1">Imaging Decisions</label><textarea id="imagingDecisions" rows="2" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></textarea></div>
                        <div><label class="block text-sm font-medium mb-1">Consultant Review</label><textarea id="consultantReview" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm"></textarea></div>
                    </div>
                </section>

                <section class="bg-blue-50 p-5 rounded-lg shadow-sm border border-blue-200">
                    <h2 class="text-lg font-bold text-blue-900 mb-2">Post-CT / Definitive Care Plan</h2>
                    <textarea id="postCtPlan" rows="4" class="w-full px-3 py-2 border border-blue-300 rounded-md shadow-sm text-sm" placeholder="Summary..."></textarea>
                </section>

                <section id="sec-secondary" class="bg-white p-5 rounded-lg shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold text-slate-800 mb-4 pb-2 border-b">Secondary Survey</h2>
                    <div class="space-y-3">
                        <div><label class="block text-xs font-bold text-slate-500 uppercase">Head/Face</label><textarea id="ss_head" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm mb-2" placeholder="Head"></textarea><textarea id="ss_face" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm" placeholder="Face"></textarea></div>
                        <div><label class="block text-xs font-bold text-slate-500 uppercase">Eyes/Neck</label><textarea id="ss_eyes" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm mb-2" placeholder="Eyes"></textarea><textarea id="ss_neck" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm" placeholder="Neck"></textarea></div>
                        <div><label class="block text-xs font-bold text-slate-500 uppercase">Chest/Abdo/Pelvis</label><textarea id="ss_chest" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm mb-2" placeholder="Chest"></textarea><textarea id="ss_abdomen" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm mb-2" placeholder="Abdomen"></textarea><textarea id="ss_pelvis" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm" placeholder="Pelvis"></textarea></div>
                        <div><label class="block text-xs font-bold text-slate-500 uppercase">Back/Voice</label><textarea id="ss_back" rows="1" class="w-full px-3 py-2 border border-slate-300 rounded text-sm mb-2" placeholder="Back"></textarea><input type="text" id="ss_voice" class="w-full px-3 py-2 border border-slate-300 rounded text-sm" placeholder="Voice"></div>
                    </div>
                    
                    <div id="ss_upperLimbs" class="mt-6 pt-4 border-t"></div>
                    <div id="ss_lowerLimbs" class="mt-4 pt-4 border-t"></div>
                    <div id="ss_hands" class="mt-4 pt-4 border-t"></div>
                    
                    <div class="mt-6 bg-slate-50 p-3 rounded border border-slate-200">
                        <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Repeat VBG</h4>
                         <div class="grid grid-cols-4 sm:grid-cols-7 gap-2">
                            <div><label class="block text-[10px] uppercase text-slate-500">pH</label><input type="number" id="vbgRepeat_ph" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">pCO2</label><input type="number" id="vbgRepeat_pco2" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">pO2</label><input type="number" id="vbgRepeat_po2" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">HCO3</label><input type="number" id="vbgRepeat_hco3" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">BE</label><input type="number" id="vbgRepeat_be" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">Lac</label><input type="number" id="vbgRepeat_lactate" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                            <div><label class="block text-[10px] uppercase text-slate-500">Ca++</label><input type="number" id="vbgRepeat_ionisedCa" class="w-full px-1 py-1 text-sm border-slate-300 rounded"></div>
                        </div>
                        <textarea id="vbgRepeat_notes" rows="1" class="w-full mt-2 px-2 py-1 text-sm border-slate-300 rounded" placeholder="Repeat VBG Notes"></textarea>
                    </div>
                </section>
                
                 <section class="bg-slate-800 p-5 rounded-lg shadow-md text-white">
                    <h2 class="text-lg font-bold mb-3">Problem List / Impression</h2>
                    <textarea id="problemList" rows="5" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-md focus:ring-blue-500 focus:border-blue-500 text-sm text-white placeholder-slate-400" placeholder="1. ...&#x0a;2. ..."></textarea>
                </section>
            </div>

            <div class="lg:col-span-5 xl:col-span-4 relative">
                <div class="sticky top-24 space-y-6">
                    <section class="bg-white p-4 rounded-lg shadow-lg border border-slate-200">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Initial Note</h2>
                            <button id="copyInitial" class="px-3 py-1 text-xs font-bold bg-blue-600 text-white rounded hover:bg-blue-700 transition active:scale-95">Copy</button>
                        </div>
                        <textarea readonly id="initialNoteOutput" class="w-full h-80 p-3 bg-slate-50 border border-slate-200 rounded text-xs font-mono text-slate-600 whitespace-pre-wrap focus:outline-none resize-none"></textarea>
                    </section>
                    
                    <section class="bg-white p-4 rounded-lg shadow-lg border border-slate-200">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-sm font-bold text-slate-700 uppercase tracking-wide">Secondary Survey Note</h2>
                            <button id="copySecondary" class="px-3 py-1 text-xs font-bold bg-blue-600 text-white rounded hover:bg-blue-700 transition active:scale-95">Copy</button>
                        </div>
                        <textarea readonly id="secondaryNoteOutput" class="w-full h-80 p-3 bg-slate-50 border border-slate-200 rounded text-xs font-mono text-slate-600 whitespace-pre-wrap focus:outline-none resize-none"></textarea>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA STORE (UNCHANGED) ---
            const patientData = {
                specialtyAttendances: '',
                age: '', ageEstimated: false, timeOfIncident: '', mechanism: '', injuries: '', signs: '',
                incidentLocation: '', policeAware: 'Unknown', preHospitalTreatment: '', preHospitalOther: '', preHospitalTimings: '',
                history: { a: '', m: '', p: '', l: '', e: '' },
                catastrophicHaemorrhage: { present: 'No', details: '', tourniquet: '', intervention: '' },
                airway: { status: 'Patent', notes: '', cSpineImmobilised: false },
                breathing: { rr: '', sats: '', o2: 'On Air', fio2: '', percussion: 'Resonant', auscultation: 'Equal air entry', findings: [], notes: '' },
                circulation: { hr: '', bp: '', bp_type: 'Non-Invasive', capRefill: '', pelvis: 'Stable', floor: 'No PR', pulse: 'None', notes: '', txaGiven: 'No', bloodTransfusionRequired: 'No', calciumGiven: 'No' },
                disability: { gcsE: 4, gcsV: 5, gcsM: 6, avpu: 'Alert', pupil_left: '3mm PERL', pupil_right: '3mm PERL', glucose: '', notes: '', c_spine_decision: 'Imaging Required', c_spine_criteria: [] },
                exposure: { temp: '', notes: '' },
                wetflag: null,
                efast: { views: [], summary: '' },
                vbgInitial: { ph: '', pco2: '', po2: '', hco3: '', be: '', lactate: '', ionisedCa: '', notes: '' },
                mhp: { activated: 'No', time: '', packGiven: '', notes: '' },
                ecg: '', pregnancy: 'Not applicable', drugsPrescribed: '', imagingDecisions: '', consultantReview: '',
                postCtPlan: '',
                problemList: '',
                secondarySurvey: {
                    head: { findings: 'Normocephalic, no signs of injury.', eyes: 'PERLA, EOMI.' },
                    face: { findings: 'Symmetrical, no bony tenderness.' },
                    neck: { findings: 'Non-tender, no deformity, trachea central.', voice: 'Normal' },
                    chest: { findings: 'Symmetrical expansion, no tenderness.' },
                    abdomen: { findings: 'Soft, non-tender, no distension.' },
                    pelvis: { findings: 'Appears stable, non-tender.' },
                    upperLimbs: { left: { motor: '5/5', sensory: 'Intact', reflexes: 'Normal', notes: '' }, right: { motor: '5/5', sensory: 'Intact', reflexes: 'Normal', notes: '' } },
                    lowerLimbs: { left: { motor: '5/5', sensory: 'Intact', reflexes: 'Normal', notes: '' }, right: { motor: '5/5', sensory: 'Intact', reflexes: 'Normal', notes: '' } },
                    hands: { left: { motor: '5/5', sensory: 'Intact', reflexes: 'N/A', notes: '' }, right: { motor: '5/5', sensory: 'Intact', reflexes: 'N/A', notes: '' } },
                    back: { findings: 'Log roll performed. No spinal tenderness or deformity.' },
                },
                vbgRepeat: { ph: '', pco2: '', po2: '', hco3: '', be: '', lactate: '', ionisedCa: '', notes: '' },
            };

            // --- CONSTANTS & DEFS ---
            const GCS_E_OPTIONS = [ { value: 4, label: '4 - Spontaneous' }, { value: 3, label: '3 - To Voice' }, { value: 2, label: '2 - To Pain' }, { value: 1, label: '1 - None' }];
            const GCS_V_OPTIONS = [ { value: 5, label: '5 - Orientated' }, { value: 4, label: '4 - Confused' }, { value: 3, label: '3 - Inappropriate' }, { value: 2, label: '2 - Incomprehensible' }, { value: 1, label: '1 - None' }];
            const GCS_M_OPTIONS = [ { value: 6, label: '6 - Obeys Commands' }, { value: 5, label: '5 - Localises Pain' }, { value: 4, label: '4 - Withdraws' }, { value: 3, label: '3 - Flexion' }, { value: 2, label: '2 - Extension' }, { value: 1, label: '1 - None' }];
            const BREATHING_FINDINGS = ['Chest wall injury', 'Surgical emphysema', 'Crepitus', 'Flail segment', 'Sucking chest wound', 'Reduced chest expansion'];
            const EFAST_VIEWS = ["RUQ (Morison's Pouch)", "LUQ (Splenorenal)", "Pelvic (Pouch of Douglas)", "Pericardial", "Lungs"];
            const CSPINE_CRITERIA = [
                "No posterior midline c-spine tenderness",
                "No focal neurologic deficit",
                "Normal level of alertness (GCS 15)",
                "No evidence of intoxication",
                "No distracting painful injury"
            ];

            // --- UI ELEMENT GETTERS ---
            const getEl = (id) => document.getElementById(id);
            const initialNoteOutput = getEl('initialNoteOutput');
            const secondaryNoteOutput = getEl('secondaryNoteOutput');

            // --- NOTE GENERATION LOGIC (UNCHANGED) ---
            function updateNotes() {
                // Initial Note
                let note = `**Major Trauma Initial Assessment**\n\n`;
                note += `**Specialty Attendances:** ${patientData.specialtyAttendances || 'N/S'}\n\n`;
                const ageString = `${patientData.age || 'N/S'}${patientData.ageEstimated ? ' (Estimated)' : ''}`;
                note += `**ATMIST Handover:**\n- Age: ${ageString}\n- Time: ${patientData.timeOfIncident || 'N/S'}\n- Mechanism: ${patientData.mechanism || 'N/S'}\n- Injuries: ${patientData.injuries || 'N/S'}\n- Signs: ${patientData.signs || 'N/S'}\n\n`;
                
                const { catastrophicHaemorrhage: ch, airway, breathing, circulation, disability, exposure, wetflag, efast, mhp, vbgInitial } = patientData;
                
                if (wetflag) {
                    note += `**Paediatric WETFLAG (Age ${patientData.age}):**\n`;
                    note += `- Weight: ${wetflag.weight.toFixed(1)} kg\n- Energy: ${wetflag.energy.toFixed(1)} J\n- Tube: ${wetflag.tube.toFixed(1)} mm\n`;
                    note += `- Fluids: ${wetflag.fluids.toFixed(1)} ml\n- Lorazepam: ${wetflag.lorazepam.toFixed(1)} mg\n- Adrenaline: ${wetflag.adrenaline.toFixed(1)} ml (1:10k)\n- Glucose: ${wetflag.glucose.toFixed(1)} ml (10%)\n\n`;
                }
                
                note += `**Pre-hospital Details:**\n- Incident Location: ${patientData.incidentLocation || 'N/S'}\n- Police Aware: ${patientData.policeAware}\n- Timings: ${patientData.preHospitalTimings || 'N/S'}\n- Treatment: ${patientData.preHospitalTreatment || 'N/S'}\n- Other Notes: ${patientData.preHospitalOther || 'N/S'}\n\n`;
                note += `**<C> Catastrophic Haemorrhage:**\n- Present: ${ch.present}. ${ch.details ? `Details: ${ch.details}.` : ''} ${ch.tourniquet ? `Tourniquet: ${ch.tourniquet}.` : ''} ${ch.intervention ? `Intervention: ${ch.intervention}` : ''}\n\n`;
                note += `**Primary Survey (ABCDE):**\n`;
                note += `A: ${airway.status}. C-Spine Immobilised: ${airway.cSpineImmobilised ? 'Yes' : 'No'}. ${airway.notes ? `Notes: ${airway.notes}` : ''}\n`;
                const o2String = breathing.o2 === 'On Oxygen' ? `On Oxygen (${breathing.fio2 || 'N/S'})` : 'On Air';
                const findingsString = breathing.findings.map(f => `${f.finding} (${f.side})`).join(', ');
                note += `B: RR ${breathing.rr || 'N/A'}. Sats ${breathing.sats || 'N/A'}% (${o2String}). Percussion: ${breathing.percussion}. Auscultation: ${breathing.auscultation}. ${findingsString ? `Findings: ${findingsString}. ` : ''}${breathing.notes ? `Notes: ${breathing.notes}` : ''}\n`;
                note += `C: HR ${circulation.hr || 'N/A'}. BP ${circulation.bp || 'N/A'} (${circulation.bp_type}). Cap refill ${circulation.capRefill || 'N/A'}s. Pelvis ${circulation.pelvis}. Pulse: ${circulation.pulse}. On floor: ${circulation.floor}. TXA Given: ${circulation.txaGiven}. Transfusion Required: ${circulation.bloodTransfusionRequired}. Calcium Given: ${circulation.calciumGiven}. ${circulation.notes ? `Notes: ${circulation.notes}` : ''}\n`;
                const totalGCS = isNaN(parseInt(disability.gcsE, 10) + parseInt(disability.gcsV, 10) + parseInt(disability.gcsM, 10)) ? 'N/A' : parseInt(disability.gcsE, 10) + parseInt(disability.gcsV, 10) + parseInt(disability.gcsM, 10);
                const cSpineCriteriaString = disability.c_spine_criteria.length > 0 ? ` (Criteria NOT met: ${disability.c_spine_criteria.join(', ')})` : ' (All criteria met)';
                note += `D: AVPU: ${disability.avpu}. GCS ${totalGCS} (E${disability.gcsE}V${disability.gcsV}M${disability.gcsM}). Pupils: (L) ${disability.pupil_left || 'N/S'}, (R) ${disability.pupil_right || 'N/S'}. Blood glucose ${disability.glucose || 'N/A'} mmol/L. C-Spine Assessment: ${disability.c_spine_decision}${disability.c_spine_decision === 'Clinically Cleared' ? cSpineCriteriaString : ''}. ${disability.notes ? `Notes: ${disability.notes}` : ''}\n`;
                note += `E: Temp ${exposure.temp || 'N/A'}Â°C. ${exposure.notes ? `Notes: ${exposure.notes}` : ''}\n\n`;
                
                note += `**EFAST Scan:**\n- Views Imaged: ${efast.views.length > 0 ? efast.views.join(', ') : 'None'}.\n- Summary: ${efast.summary || 'Not performed.'}\n\n`;

                note += `**Major Haemorrhage Protocol:**\n- Activated: ${mhp.activated}. ${mhp.activated === 'Yes' ? `Time: ${mhp.time || 'N/S'}. Pack(s) Given: ${mhp.packGiven || 'N/S'}.` : ''} ${mhp.notes ? `Notes: ${mhp.notes}` : ''}\n\n`;
                const formatVBG = (vbg) => `pH ${vbg.ph || 'N/A'}, pCO2 ${vbg.pco2 || 'N/A'}, pO2 ${vbg.po2 || 'N/A'}, HCO3 ${vbg.hco3 || 'N/A'}, BE ${vbg.be || 'N/A'}, Lactate ${vbg.lactate || 'N/A'}, Ionised Ca++ ${vbg.ionisedCa || 'N/A'}. ${vbg.notes ? `Notes: ${vbg.notes}` : ''}`;
                note += `**Initial VBG/ABG:** ${formatVBG(vbgInitial)}\n\n`;
                note += `**Investigations & Immediate Plan:**\n- ECG: ${patientData.ecg || 'Not performed.'}\n- Pregnancy Status: ${patientData.pregnancy}\n- Drugs Prescribed (inc. analgesia/antiemetics): ${patientData.drugsPrescribed || 'None.'}\n- Imaging Plan: ${patientData.imagingDecisions || 'Pending review.'}\n- Consultant Review: ${patientData.consultantReview || 'Pending.'}\n\n`;
                note += `**Post-CT / Definitive Care Plan:**\n${patientData.postCtPlan || 'Pending imaging.'}\n`;
                
                initialNoteOutput.value = note;

                // Secondary Note
                const { secondarySurvey: ss, vbgRepeat } = patientData;
                let secNote = `**Secondary Survey:**\n\n`;
                secNote += `- Head: ${ss.head.findings}\n`;
                secNote += `- Eyes/Vision: ${ss.head.eyes}\n`;
                secNote += `- Face: ${ss.face.findings}\n`;
                secNote += `- Neck (C-Spine): ${ss.neck.findings}\n`;
                secNote += `- Voice: ${ss.neck.voice}\n`;
                secNote += `- Chest: ${ss.chest.findings}\n`;
                secNote += `- Abdomen: ${ss.abdomen.findings}\n`;
                secNote += `- Pelvis: ${ss.pelvis.findings}\n`;
                secNote += `- Back & Spine: ${ss.back.findings}\n\n`;
                secNote += `**Neurological Examination (Limbs):**\n`;
                const formatLimb = (side, data) => `  - ${side}:\n    - Motor: ${data.motor}\n    - Sensory: ${data.sensory}\n    - Reflexes: ${data.reflexes}\n    - Notes: ${data.notes || 'None'}`;
                secNote += `- Upper Limbs:\n${formatLimb('Left', ss.upperLimbs.left)}\n${formatLimb('Right', ss.upperLimbs.right)}\n`;
                secNote += `- Lower Limbs:\n${formatLimb('Left', ss.lowerLimbs.left)}\n${formatLimb('Right', ss.lowerLimbs.right)}\n`;
                secNote += `- Hands:\n${formatLimb('Left', ss.hands.left)}\n${formatLimb('Right', ss.hands.right)}\n\n`;
                secNote += `**Repeat VBG/ABG:** ${formatVBG(vbgRepeat)}\n\n`;
                secNote += `**Problem List:**\n${patientData.problemList || 'Not yet formulated.'}\n`;

                secondaryNoteOutput.value = secNote;
            }

            // --- UI INITIALIZATION & BINDING ---
            function setupEventListeners() {
                // Simple text/number inputs
                const simpleInputs = [
                    'specialtyAttendances',
                    'timeOfIncident', 'mechanism', 'injuries', 'signs',
                    'incidentLocation', 'preHospitalTimings', 'preHospitalTreatment', 'preHospitalOther',
                    'history_a', 'history_m', 'history_p', 'history_l', 'history_e',
                    'catHaem_details', 'catHaem_tourniquet', 'catHaem_intervention',
                    'airway_notes', 'breathing_rr', 'breathing_sats', 'breathing_fio2', 'breathing_percussion', 'breathing_auscultation', 'breathing_notes',
                    'circ_hr', 'circ_bp', 'circ_capRefill', 'circ_pelvis', 'circ_floor', 'circ_notes',
                    'disability_pupil_left', 'disability_pupil_right', 'disability_glucose', 'disability_notes',
                    'exposure_temp', 'exposure_notes',
                    'efast_summary',
                    'mhp_time', 'mhp_packGiven', 'mhp_notes',
                    'vbgInitial_ph', 'vbgInitial_pco2', 'vbgInitial_po2', 'vbgInitial_hco3', 'vbgInitial_be', 'vbgInitial_lactate', 'vbgInitial_ionisedCa', 'vbgInitial_notes',
                    'ecg', 'drugsPrescribed', 'imagingDecisions', 'consultantReview', 'postCtPlan', 'problemList',
                    'ss_head', 'ss_eyes', 'ss_face', 'ss_neck', 'ss_voice', 'ss_chest', 'ss_abdomen', 'ss_pelvis', 'ss_back',
                    'ss_upperLimbs_left_motor', 'ss_upperLimbs_left_sensory', 'ss_upperLimbs_left_reflexes', 'ss_upperLimbs_left_notes',
                    'ss_upperLimbs_right_motor', 'ss_upperLimbs_right_sensory', 'ss_upperLimbs_right_reflexes', 'ss_upperLimbs_right_notes',
                    'ss_lowerLimbs_left_motor', 'ss_lowerLimbs_left_sensory', 'ss_lowerLimbs_left_reflexes', 'ss_lowerLimbs_left_notes',
                    'ss_lowerLimbs_right_motor', 'ss_lowerLimbs_right_sensory', 'ss_lowerLimbs_right_reflexes', 'ss_lowerLimbs_right_notes',
                    'ss_hands_left_motor', 'ss_hands_left_sensory', 'ss_hands_left_reflexes', 'ss_hands_left_notes',
                    'ss_hands_right_motor', 'ss_hands_right_sensory', 'ss_hands_right_reflexes', 'ss_hands_right_notes',
                    'vbgRepeat_ph', 'vbgRepeat_pco2', 'vbgRepeat_po2', 'vbgRepeat_hco3', 'vbgRepeat_be', 'vbgRepeat_lactate', 'vbgRepeat_ionisedCa', 'vbgRepeat_notes'
                ];
                simpleInputs.forEach(id => {
                    const el = getEl(id);
                    if (!el) return;
                    el.addEventListener('input', (e) => {
                        const keys = id.split('_');
                        if (keys.length === 1) patientData[keys[0]] = e.target.value;
                        else if (keys[0] === 'efast') patientData.efast.summary = e.target.value;
                        else if (keys[0] === 'history') patientData.history[keys[1]] = e.target.value;
                        else if (keys.length === 2) patientData[keys[0]][keys[1]] = e.target.value;
                        else if (keys.length === 3) patientData[keys[0]][`${keys[1]}_${keys[2]}`] = e.target.value;
                        else if (keys.length === 4) patientData.secondarySurvey[keys[1]][keys[2]][keys[3]] = e.target.value;
                        updateNotes();
                    });
                });

                // Age input special handling
                getEl('age').addEventListener('input', (e) => {
                    patientData.age = e.target.value;
                    updateNotes();
                });

                // Checkboxes
                getEl('ageEstimated').addEventListener('change', e => {
                    patientData.ageEstimated = e.target.checked;
                    updateNotes();
                });
                getEl('cSpineImmobilised').addEventListener('change', e => {
                    patientData.airway.cSpineImmobilised = e.target.checked;
                    updateNotes();
                });

                // Radio buttons
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        const name = e.target.name;
                        const value = e.target.value;
                        if (name === 'policeAware') patientData.policeAware = value;
                        else if (name === 'catHaem') patientData.catastrophicHaemorrhage.present = value;
                        else if (name === 'airwayStatus') patientData.airway.status = value;
                        else if (name === 'breathing_o2') {
                            patientData.breathing.o2 = value;
                            getEl('fio2_container').classList.toggle('hidden', value === 'On Air');
                        }
                        else if (name === 'circ_bp_type') patientData.circulation.bp_type = value;
                        else if (name === 'pulse_check') patientData.circulation.pulse = value;
                        else if (name === 'disability_avpu') patientData.disability.avpu = value;
                        else if (name === 'mhp') patientData.mhp.activated = value;
                        else if (name === 'pregnancy') patientData.pregnancy = value;
                        else if (name === 'txaGiven') patientData.circulation.txaGiven = value;
                        else if (name === 'transfusionRequired') patientData.circulation.bloodTransfusionRequired = value;
                        else if (name === 'calciumGiven') patientData.circulation.calciumGiven = value;
                        
                        // Conditional UI
                        if (name === 'catHaem') getEl('catHaemDetails').classList.toggle('hidden', value === 'No');
                        if (name === 'mhp') getEl('mhpDetails').classList.toggle('hidden', value === 'No');
                        
                        updateNotes();
                    });
                });

                // Checkboxes for lists
                ['breathing_findings', 'efast_views', 'cspine_criteria'].forEach(id => {
                    const container = getEl(id);
                    if (!container) return;
                    container.addEventListener('change', (e) => {
                        if (e.target.type === 'checkbox') {
                            const key = id.split('_')[0];
                            if (key === 'breathing') {
                                const { finding, side } = e.target.dataset;
                                patientData.breathing.findings = patientData.breathing.findings.filter(f => !(f.finding === finding && f.side === side));
                                if (e.target.checked) {
                                    patientData.breathing.findings.push({ finding, side });
                                }
                            } else {
                                const { value, checked } = e.target;
                                let list;
                                if (key === 'cspine') list = patientData.disability.c_spine_criteria;
                                else list = patientData[key].views;
                                
                                if (checked) {
                                    if (!list.includes(value)) list.push(value);
                                } else {
                                    if (key === 'cspine') patientData.disability.c_spine_criteria = list.filter(f => f !== value);
                                    else if (patientData[key].views) patientData[key].views = list.filter(f => f !== value);
                                }
                            }
                            updateNotes();
                        }
                    });
                });
                
                // Selects
                ['disability_gcsE', 'disability_gcsV', 'disability_gcsM', 'cspine_decision'].forEach(id => {
                    getEl(id).addEventListener('change', e => {
                        const field = id.split('_');
                        if (field[0] === 'cspine') {
                            patientData.disability.c_spine_decision = e.target.value;
                        } else {
                            patientData.disability[field[1]] = e.target.value;
                        }
                        updateNotes();
                    });
                });
            }

            function populateStaticContent() {
                // Breathing checkboxes - RE-STYLED
                const breathingFindingsContainer = getEl('breathing_findings');
                BREATHING_FINDINGS.forEach(finding => {
                    const findingEl = document.createElement('div');
                    findingEl.className = 'flex items-center justify-between bg-slate-50 p-2 rounded border border-slate-100 text-sm';
                    findingEl.innerHTML = `
                        <span class="font-medium text-slate-700">${finding}</span>
                        <div class="flex space-x-2">
                            <label class="flex items-center space-x-1 cursor-pointer hover:bg-slate-200 px-1 rounded"><input type="checkbox" data-finding="${finding}" data-side="L" class="h-3 w-3 text-sky-600 rounded"><span>L</span></label>
                            <label class="flex items-center space-x-1 cursor-pointer hover:bg-slate-200 px-1 rounded"><input type="checkbox" data-finding="${finding}" data-side="R" class="h-3 w-3 text-sky-600 rounded"><span>R</span></label>
                        </div>
                    `;
                    breathingFindingsContainer.appendChild(findingEl);
                });
                
                // EFAST checkboxes - RE-STYLED
                const efastViewsContainer = getEl('efast_views');
                EFAST_VIEWS.forEach(view => {
                    efastViewsContainer.innerHTML += `<label class="flex items-center space-x-2 cursor-pointer p-1 hover:bg-slate-50 rounded"><input type="checkbox" value="${view}" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"><span class="text-slate-700">${view}</span></label>`;
                });

                // C-Spine checkboxes - RE-STYLED
                const cspineContainer = getEl('cspine_criteria');
                CSPINE_CRITERIA.forEach(rule => {
                    cspineContainer.innerHTML += `<label class="flex items-start space-x-2 cursor-pointer p-1 hover:bg-red-50 rounded"><input type="checkbox" value="${rule}" class="mt-0.5 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"><span class="text-sm text-slate-700">${rule}</span></label>`;
                });

                // GCS dropdowns
                const populateSelect = (id, options, defaultValue) => {
                    const select = getEl(id);
                    options.forEach(opt => select.add(new Option(opt.label, opt.value)));
                    select.value = defaultValue;
                };
                populateSelect('disability_gcsE', GCS_E_OPTIONS, 4);
                populateSelect('disability_gcsV', GCS_V_OPTIONS, 5);
                populateSelect('disability_gcsM', GCS_M_OPTIONS, 6);
                
                // Limb sections - RE-STYLED
                const createLimbSection = (containerId, title, limbKey) => {
                    const container = getEl(containerId);
                    container.innerHTML = `
                        <h4 class="font-bold text-sm text-slate-800 mb-3 bg-slate-100 p-2 rounded">${title}</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-3 rounded border border-slate-100">
                                <h5 class="font-bold text-xs text-slate-500 uppercase mb-2 border-b pb-1">Left</h5>
                                <div class="space-y-2">
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Motor</label><textarea id="ss_${limbKey}_left_motor" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Sensory</label><textarea id="ss_${limbKey}_left_sensory" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Reflexes</label><textarea id="ss_${limbKey}_left_reflexes" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Notes</label><textarea id="ss_${limbKey}_left_notes" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-3 rounded border border-slate-100">
                                <h5 class="font-bold text-xs text-slate-500 uppercase mb-2 border-b pb-1">Right</h5>
                                <div class="space-y-2">
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Motor</label><textarea id="ss_${limbKey}_right_motor" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Sensory</label><textarea id="ss_${limbKey}_right_sensory" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Reflexes</label><textarea id="ss_${limbKey}_right_reflexes" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                    <div><label class="block text-[10px] uppercase font-bold text-slate-400">Notes</label><textarea id="ss_${limbKey}_right_notes" rows="1" class="w-full px-2 py-1 text-sm border-slate-300 rounded"></textarea></div>
                                </div>
                            </div>
                        </div>`;
                };
                createLimbSection('ss_upperLimbs', 'Upper Limbs', 'upperLimbs');
                createLimbSection('ss_lowerLimbs', 'Lower Limbs', 'lowerLimbs');
                createLimbSection('ss_hands', 'Hands', 'hands');
            }
            
            function setInitialValues() {
                // Set text/textarea values from initial data
                Object.keys(patientData.secondarySurvey).forEach(part => {
                    if (typeof patientData.secondarySurvey[part].findings !== 'undefined') {
                        getEl(`ss_${part}`).value = patientData.secondarySurvey[part].findings;
                    }
                    if (patientData.secondarySurvey[part].eyes) getEl('ss_eyes').value = patientData.secondarySurvey[part].eyes;
                    if (patientData.secondarySurvey[part].voice) getEl('ss_voice').value = patientData.secondarySurvey[part].voice;
                });
                ['upperLimbs', 'lowerLimbs', 'hands'].forEach(limbKey => {
                    ['left', 'right'].forEach(side => {
                        ['motor', 'sensory', 'reflexes', 'notes'].forEach(field => {
                            const id = `ss_${limbKey}_${side}_${field}`;
                            const value = patientData.secondarySurvey[limbKey][side][field];
                            if(getEl(id)) getEl(id).value = value;
                        });
                    });
                });
            }

            // --- COPY BUTTONS - ENHANCED FEEDBACK ---
            function setupCopyButtons() {
                ['Initial', 'Secondary'].forEach(type => {
                    const btn = getEl(`copy${type}`);
                    btn.addEventListener('click', () => {
                        const note = getEl(`${type.toLowerCase()}NoteOutput`).value;
                        navigator.clipboard.writeText(note).then(() => {
                            const originalText = btn.textContent;
                            btn.textContent = 'Copied!';
                            btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                            btn.classList.add('bg-green-600', 'hover:bg-green-700');
                            setTimeout(() => { 
                                btn.textContent = originalText; 
                                btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                                btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy text: ', err);
                            btn.textContent = 'Error';
                        });
                    });
                });
            }

            // --- APP START ---
            populateStaticContent();
            setInitialValues();
            setupEventListeners();
            setupCopyButtons();
            updateNotes(); // Initial note generation
        });
    </script>
</body>
</html>
